// USER CODE BEGIN Header
//!
//!*****************************************************************************
//! @file    UART/UART_WakeUpFromStopUsingFIFO/Src/stm32l5xx_hal_msp.c
//! @author  MCD Application Team
//! @brief   HAL MSP module.
//!*****************************************************************************
//! @attention
//!
//! <h2><center>&copy; Copyright (c) 2020 STMicroelectronics.
//! All rights reserved.</center></h2>
//!
//! This software component is licensed by ST under BSD 3-Clause license,
//! the "License"; You may not use this file except in compliance with the
//! License. You may obtain a copy of the License at:
//!                        opensource.org/licenses/BSD-3-Clause
//!
//!*****************************************************************************
//!
// USER CODE END Header

// Includes ------------------------------------------------------------------
//#include "main.h"
#include "stm32l5xx_hal.h"

// USER CODE BEGIN Includes

// USER CODE END Includes

// Private typedef -----------------------------------------------------------
// USER CODE BEGIN TD

// USER CODE END TD

// Private define ------------------------------------------------------------
// USER CODE BEGIN Define

// USER CODE END Define

// Private macro -------------------------------------------------------------
// USER CODE BEGIN Macro

// USER CODE END Macro

// Private variables ---------------------------------------------------------
// USER CODE BEGIN PV

// USER CODE END PV

// Private function prototypes -----------------------------------------------
// USER CODE BEGIN PFP

// USER CODE END PFP

// External functions --------------------------------------------------------
// USER CODE BEGIN ExternalFunctions

// USER CODE END ExternalFunctions

// USER CODE BEGIN 0

// USER CODE END 0
//!
//! Initializes the Global MSP.
//!
void HAL_MspInit(void)
{
  // USER CODE BEGIN MspInit 0

  // USER CODE END MspInit 0

  __HAL_RCC_SYSCFG_CLK_ENABLE();
  __HAL_RCC_PWR_CLK_ENABLE();

  // System interrupt init

  //! Disable the internal Pull-Up in Dead Battery pins of UCPD peripheral
  //!
  HAL_PWREx_DisableUCPDDeadBattery();

  // USER CODE BEGIN MspInit 1

  // USER CODE END MspInit 1
}

// NOTE:
// STM32Cube's initialization calls the weakly defined HAL_InitTick(), which
// by default configures and starts the Systick interrupt. This is TOO EARLY,
// because the system os NOT ready yet to handle interrupts.
// To avoid problems, a dummy definition for HAL_InitTick() is provided
// in the file stm32l5xx_hal_msp.c. The SystTick is configured and
// started later in QF_onStartup().
//
HAL_StatusTypeDef HAL_InitTick(uint32_t TickPriority) {
    (void)TickPriority; // unused parameter
    return HAL_OK;
}


//!
//! @brief UART MSP Initialization
//! This function configures the hardware resources used in this example
//! @param huart: UART handle pointer
//! @retval None
//!
void HAL_UART_MspInit(UART_HandleTypeDef* huart)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};
  RCC_PeriphCLKInitTypeDef PeriphClkInit = {0};
  if(huart->Instance==LPUART1)
  {
  // USER CODE BEGIN LPUART1_MspInit 0

  // USER CODE END LPUART1_MspInit 0
  //! Initializes the peripherals clock
  //!
    PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_LPUART1;
    PeriphClkInit.Lpuart1ClockSelection = RCC_LPUART1CLKSOURCE_HSI;
    if (HAL_RCCEx_PeriphCLKConfig(&PeriphClkInit) != HAL_OK)
    {
      //assert_failed("HAL_UART_MspInit", 10);
    }

    // Peripheral clock enable
    __HAL_RCC_LPUART1_CLK_ENABLE();

    __HAL_RCC_GPIOG_CLK_ENABLE();
    HAL_PWREx_EnableVddIO2();
    //!LPUART1 GPIO Configuration
    //! PG7     ------> LPUART1_TX
    //! PG8     ------> LPUART1_RX
    //!
    GPIO_InitStruct.Pin = GPIO_PIN_7|GPIO_PIN_8;
    GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
    GPIO_InitStruct.Pull = GPIO_PULLUP;
    GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
    GPIO_InitStruct.Alternate = GPIO_AF8_LPUART1;
    HAL_GPIO_Init(GPIOG, &GPIO_InitStruct);

  // USER CODE BEGIN LPUART1_MspInit 1

  // USER CODE END LPUART1_MspInit 1
  }

}

//!
//! @brief UART MSP De-Initialization
//! This function freeze the hardware resources used in this example
//! @param huart: UART handle pointer
//! @retval None
//!
void HAL_UART_MspDeInit(UART_HandleTypeDef* huart)
{
  if(huart->Instance==LPUART1)
  {
  // USER CODE BEGIN LPUART1_MspDeInit 0

  // USER CODE END LPUART1_MspDeInit 0
    // Peripheral clock disable
    __HAL_RCC_LPUART1_CLK_DISABLE();

    //!LPUART1 GPIO Configuration
    //! PG7     ------> LPUART1_TX
    //! PG8     ------> LPUART1_RX
    //!
    HAL_GPIO_DeInit(GPIOG, GPIO_PIN_7|GPIO_PIN_8);

    // LPUART1 interrupt DeInit
    HAL_NVIC_DisableIRQ(LPUART1_IRQn);
  // USER CODE BEGIN LPUART1_MspDeInit 1

  // USER CODE END LPUART1_MspDeInit 1
  }

}

// USER CODE BEGIN 1

// USER CODE END 1

//*********************** (C) COPYRIGHT STMicroelectronics *****END OF FILE*****
